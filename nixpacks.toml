[phases.setup]
nixPkgs = ["php82", "php82Packages.composer", "nodejs_18"]

[phases.install]
cmds = [
  "composer install --no-dev --optimize-autoloader",
  "npm ci"
]

[phases.build]
cmds = [
  "mkdir -p public/build",
  "echo 'Building assets with Vite...'",
  "npm run build || (echo 'Build failed!' && exit 1)",
  "echo 'Verifying build output...'",
  "test -f public/build/.vite/manifest.json || (echo 'Manifest file missing at public/build/.vite/manifest.json!' && ls -la public/build/ && exit 1)",
  "ls -la public/build/assets/ || (echo 'No assets directory found' && ls -la public/build/ && exit 1)",
  "echo '✓ Manifest file found'",
  "echo '✓ Assets directory found'",
  "echo 'Build completed successfully!'"
]

[start]
cmd = "chmod +x start.sh && ./start.sh"
